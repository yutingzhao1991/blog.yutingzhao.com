<!-- 没多少代码，博客所有的代码都在 github 上面，本身也是托管在gitpage上的 -->
<!-- 欢迎交换友情链接，可以微博私信我！ -->
<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>NodeJS工具模块FileSearcher</title>
  <meta name='viewport' content='width=device-width'>
  <meta name='renderer' content='webkit'>
  <link rel='stylesheet' href='/css/main.css' />
</head>
<body>
  <header>
    <h1><a href="http://yutingzhao.com">Love.Passion.Dream</a></h1>
    <nav>
      <ul>
        
          <li>
            <a href='/'>主页</a>
          </li>
        
          <li>
            <a href='/tags.html'>标签</a>
          </li>
        
          <li>
            <a href='/about.html'>我</a>
          </li>
        
          <li>
            <a href='/links.html'>友链</a>
          </li>
        
          <li>
            <a href='/sites.html'>收藏</a>
          </li>
        
      </ul>
    </nav>
  </header>

  <main>
    <article class="box">
  <h1>NodeJS工具模块FileSearcher</h1>
  
  <span class="post-category">
    <span class="label"></span>
  </span>
  <div class="post-meta">
    <time class="post-date">2013-03-03 13:30</time>
  </div>
  <div class="post">
  <p>需要查看文件中用到了某个类的哪些方法？</p>

<p>需要对一些文件内容进行简单替换？</p>

<p>NodeJS对文件的处理速度还是很赞的，今天写了一个NodeJS的模块，可以进行查找替换这样的简单操作。</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">var fs = require(&#39;fs&#39;);

/**
 * 读取文件
 */
var readFile = function(path) {
    return fs.readFileSync(path, &#39;utf-8&#39;);
}

/**
 * 强制写入文件
 * 如果路径不存在则创建路径
 */
writeTextToFile = function(path, text) {
    if(fs.existsSync(path)){
        //已经存在，直接写入
        fs.writeFileSync(path, text, &#39;utf-8&#39;);
    }else{
        var items = path.split(&#39;/&#39;);
        var aPath = &#39;.&#39;;
        //目录不存在，那么创建之
        for(var i=0; i&lt;items.length - 1; i++){
            aPath += &#39;/&#39; + items[i];
            if(!fs.existsSync(aPath)){
                fs.mkdirSync(aPath);
            }
        }
        fs.writeFileSync(path, text, &#39;utf-8&#39;);
    }

}

/**
 * 递归深度处理文件目录
 * @param {String} path
 * @param {Function} 文件处理函数，非异步调用
 */
var readDeeply = function(dir, handler) {
    var status = fs.statSync(dir);
    if(status.isFile()) {
        var result = handler &amp;&amp; handler(dir, readFile(dir));
        if (result) {
            //有返回数据，表示出现了文本替换
            writeTextToFile(dir, result);
        };
    } else {
        //递归遍历目录
        var files = fs.readdirSync(dir);
        for(var i=0; i&lt;files.length; i++){
            readDeeply(dir + &#39;/&#39; + files[i], handler);
        }
    }

}

/**
 * 匹配文件中的符合条件的内容并替换
 * @param {String} 搜索的目录或者文件
 * @param {String | RegExp} 匹配规则，可以是单一的字符串，也可以是正则表达式
 * @param {Funcction | String} 替换规则
 * @param {Object} 匹配和替换结果
 */
var replace = function(dir, condition, replacer) {
    var result = [];
    readDeeply(dir, function(file, text) {
        return text.replace(condition, function(word) {
            var res = null;
            if (typeof replacer == &#39;string&#39;) {
                res = replacer;
            } else if(typeof replacer == &#39;function&#39;){
                res = replacer.apply(this, this.arguments);
            } else {
            };
            result.push({
                from: file,
                source: word,
                result: res
            });
            return res;
        });
    });
    return result;
}

/**
 * 匹配文件中的符合条件的内容并返回结果
 * @param {String} 搜索的目录或者文件
 * @param {String | RegExp} 匹配规则，可以是单一的字符串，也可以是正则表达式
 * @return {Object} 匹配结果
 */
var search = function(dir, condition) {

    var result = [];
    readDeeply(dir, function(file, text) {
        var temp = text.match(condition);
        if (!temp) {
            return;
        };
        for(var i=0; i&lt;temp.length; i++) {
            result.push({
                from: file,
                result: temp[i]
            });
        }
    });
    return result;
}

exports.search = search;
exports.replace = replace;
exports.tools = {
    writeTextToFile: writeTextToFile
};
</code></pre></div>
<p>代码托管到了GIT上面，<a href="https://github.com/yutingzhao1991/FileSearcher" title="FileSearcher">FileSearcher</a>。也顺便把之前写的多人联机的贪吃蛇也放上去了，<a href="https://github.com/yutingzhao1991/GreedySnake" title="GreedySnake">GreedySnake</a>，以后有点什么都慢慢积累到上面吧，亚然说得对，这样才有积累。所谓不积小流，无以成江海；不积跬步，无以至千里！</p>

  </div>
  <div class="post-meta">
    <span>Tags: </span>
    
      <span style="margin: 5px"><a href="/tags.html#nodejs">nodejs</a></span>
    
  </div>
  <div class="section-nav">
    <div class="left align-left">
      
      <a href="/2013/01/27/%E6%B5%85%E8%B0%88%E5%89%8D%E7%AB%AF%E6%A8%A1%E5%9D%97%E5%88%92%E5%88%86%E5%92%8CMVC%E7%9A%84%E5%85%B3%E7%B3%BB.html" class="prev-next">上一篇:<b> 浅谈前端模块划分和MVC的关系</b></a>
      
    </div>
    <div class="right align-right">
      
      <a href="/2013/03/13/%E9%82%A3%E4%BA%9B%E5%B9%B4%EF%BC%8C%E6%88%91%E4%BB%AC%E4%B8%80%E8%B5%B7%E7%88%B1%E8%BF%87%E7%9A%84%E7%AE%97%E6%B3%95.html" class="prev-next">下一篇:<b> 那些年，我们一起爱过的算法</b></a>
      
    </div>
  </div>
</article>
<div class="box">
<!-- baidu shared -->
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Comment BEGIN -->
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"yutingzhao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
<!-- Comment END -->
</div>


  </main>

  <footer>
    <a href='https://github.com/yutingzhao1991'>YuTingzhao</a> Copyright © 2014 i.yutingzhao.com
  </footer>
</body>
</html>
