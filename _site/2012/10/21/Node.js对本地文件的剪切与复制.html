<!-- 没多少代码，博客所有的代码都在 github 上面，本身也是托管在gitpage上的 -->
<!-- 欢迎交换友情链接，可以微博私信我！ -->
<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>Node.js对本地文件的剪切与复制</title>
  <meta name='viewport' content='width=device-width'>
  <meta name='renderer' content='webkit'>
  <link rel='stylesheet' href='/css/main.css' />
</head>
<body>
  <header>
    <h1><a href="http://yutingzhao.com">Love.Passion.Dream</a></h1>
    <nav>
      <ul>
        
          <li>
            <a href='/'>主页</a>
          </li>
        
          <li>
            <a href='/tags.html'>标签</a>
          </li>
        
          <li>
            <a href='/about.html'>我</a>
          </li>
        
          <li>
            <a href='/links.html'>友链</a>
          </li>
        
          <li>
            <a href='/sites.html'>收藏</a>
          </li>
        
      </ul>
    </nav>
  </header>

  <main>
    <article class="box">
  <h1>Node.js对本地文件的剪切与复制</h1>
  
  <span class="post-category">
    <span class="label"></span>
  </span>
  <div class="post-meta">
    <time class="post-date">2012-10-21 17:15</time>
  </div>
  <div class="post">
  <p>有了Node.js，更纯粹的js跨平台文件处理脚本靠谱了！</p>

<p>用Node处理本地文件主要是依靠node自带的fs的包，它提供了很多<a href="http://nodejs.org/api/fs.html" title="api">api</a>可以直接操作文件。嗯，那把bat脚本移植过去........</p>

<p>咦？肿么没有复制剪切的接口？什么情况？</p>

<p>首先来看看剪切吧，剪切和复制不同，剪切只是把硬盘中文件系统的文件链接改了，文件内容存放的实际地方还是不变的。但是复制就不一样了，它还需要再拷贝一份数据。这就是为什么在同一个磁盘下面剪切会比复制快很多。当然磁盘直接就不一样了，在windows下面不同的分区可以看作是两个完全独立的文件系统，所以速度不会比复制快，甚至还多出删除的时间。所以大伙拷贝什么东西还是不用剪切了吧，还能防止异常中断导致的数据丢失。</p>

<p>嗯，上面说这么一段主要是想说的是剪切的道理其实就是重命名，so，使用rename或者renameSync就可以达到剪切的效果了。当然，不同的分区之间是不行的。</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">fs = require(&#39;fs&#39;);
fs.renameSync(&#39;./1.txt&#39;, &#39;./doc/3.txt&#39;);
fs.renameSync(&#39;./src/3.txt&#39;, &#39;D:\\3.txt&#39;);
</code></pre></div>
<p>我是在E盘忠运行上面的的代码，第二行是没有问题的，第三行符合预期报了错误，错误如下：[]()</p>

<p>那复制怎么办？先直接上代码：</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">fs = require(&#39;fs&#39;);
var util = require(&quot;util&quot;);
//fs.renameSync(&#39;./1.txt&#39;, &#39;./doc/3.txt&#39;);
//fs.renameSync(&#39;./src/3.txt&#39;, &#39;D:\\3.txt&#39;);

//copy a file
function copyFile(src, dst){
    var is = fs.createReadStream(src);
    var os = fs.createWriteStream(dst);
    util.pump(is, os, function(err){
        if(err){
            //copy error
        }
    });
}

copyFile(&#39;./src/3.txt&#39;, &#39;D:\\3.txt&#39;);
</code></pre></div>
<p>这段代码运行下来，也是没有问题的，这就达到了复制的目的。使用了util中的<a href="http://nodejs.org/api/util.html#util_util_pump_readablestream_writablestream_callback" title="pupm">pupm</a>，它会持续的传输数据流到结束。但是这个方法貌似没有它的同步版本。嗯，为什么呢？那如果需要同步拷贝数据怎么办？还有就是跨分区的剪切是不是就只能是拷贝再删除？这些问题先放着，今天好冷啊，打这么点字手都冻僵了.....</p>

<p>参考链接：<a href="https://gist.github.com/807712"></a><a href="https://gist.github.com/807712">https://gist.github.com/807712</a> <a href="https://github.com/ryanmcgrath/wrench-js"></a><a href="https://github.com/ryanmcgrath/wrench-js">https://github.com/ryanmcgrath/wrench-js</a> <a href="https://gist.github.com/992478"></a><a href="https://gist.github.com/992478">https://gist.github.com/992478</a> <a href="http://stackoverflow.com/questions/4980243/how-to-copy-a-file">http://stackoverflow.com/questions/4980243/how-to-copy-a-file</a></p>

  </div>
  <div class="post-meta">
    <span>Tags: </span>
    
      <span style="margin: 5px"><a href="/tags.html#nodejs">nodejs</a></span>
    
  </div>
  <div class="section-nav">
    <div class="left align-left">
      
      <a href="/2012/09/23/Node.JS%E5%AE%9E%E7%8E%B0%E7%94%A8%E6%88%B7%E6%8C%81%E4%B9%85%E5%8C%96%E7%99%BB%E9%99%86.html" class="prev-next">上一篇:<b> Node.JS实现用户持久化登陆</b></a>
      
    </div>
    <div class="right align-right">
      
      <a href="/2012/10/23/%E4%B8%96%E7%95%8C%E5%88%AB%E4%B8%BA%E6%88%91%E6%8B%85%E5%BF%83.html" class="prev-next">下一篇:<b> 世界别为我担心</b></a>
      
    </div>
  </div>
</article>
<div class="box">
<!-- baidu shared -->
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Comment BEGIN -->
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"yutingzhao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
<!-- Comment END -->
</div>


  </main>

  <footer>
    <a href='https://github.com/yutingzhao1991'>YuTingzhao</a> Copyright © 2014 i.yutingzhao.com
  </footer>
</body>
</html>
