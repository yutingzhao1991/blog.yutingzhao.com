<!-- 没多少代码，博客所有的代码都在 github 上面，本身也是托管在gitpage上的 -->
<!-- 欢迎交换友情链接，可以微博私信我！ -->
<!doctype html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
  <title>关于setTimeout在大量dom节点渲染时的优化分析</title>
  <meta name='viewport' content='width=device-width'>
  <meta name='renderer' content='webkit'>
  <link rel='stylesheet' href='/css/main.css' />
</head>
<body>
  <header>
    <h1><a href="http://yutingzhao.com">Love.Passion.Dream</a></h1>
    <nav>
      <ul>
        
          <li>
            <a href='/'>主页</a>
          </li>
        
          <li>
            <a href='/tags.html'>标签</a>
          </li>
        
          <li>
            <a href='/about.html'>我</a>
          </li>
        
          <li>
            <a href='/links.html'>友链</a>
          </li>
        
          <li>
            <a href='/sites.html'>收藏</a>
          </li>
        
      </ul>
    </nav>
  </header>

  <main>
    <article class="box">
  <h1>关于setTimeout在大量dom节点渲染时的优化分析</h1>
  
  <span class="post-category">
    <span class="label"></span>
  </span>
  <div class="post-meta">
    <time class="post-date">2012-07-25 21:26</time>
  </div>
  <div class="post">
  <p><span>1、</span><span>setTimeout<span>传递的函数被执行的时机：</span></span></p>

<p><span>当前任何挂起的事件运行完事件句柄并且完成了文档的当前状态更新之后。</span></p>

<p><span>当前正在执行的<span>JS</span><span>顺序执行完毕。</span></span></p>

<p><span>简单点说：当浏览器没事干的时候。</span></p>

<p><span><br>
</span></p>

<p><span>2、</span><span>用途：</span></p>

<p><span>由<span>setTimeout</span><span>执行的时机可以看出它在性能优化方面的用途。</span></span></p>

<p><span>分割需要循环处理的数组或者过长的任务，防止过长的<span>JS</span><span>执行使得</span><span>UI</span><span>的更新被中断。</span></span></p>

<p><span>通过<span>setTimeout</span><span>间隔执行代码可以留出空白时间使得</span><span>UI</span><span>可以更新，不会产生“假死”的状态。提高用户体验。</span></span></p>

<p><span><span><br>
</span></span></p>

<p><span>3、</span><span>实验对比：</span></p>

<p><span>对<span>10000</span><span>个并列的</span><span>dom</span><span>节点进行渲染，使用</span><span>Chrome</span><span>的插件</span><span>Monitor Tab</span><span>测试出的结果如下：</span></span></p>

<p><span>未使用<span>setTimeout</span><span>：</span></span></p>

<p><span><span>[]()<br>
</span></span></p>

<p><span>页面会停滞很久，然后突然渲染出来。耗时基本都在</span><span>DOM (load)</span><span></span><span>上面：</span></p>

<p><span>[]()<br>
</span></p>

<p><span><br>
</span></p>

<p><span></span></p>

<p><span>使用<span>setTimeout</span><span>：</span></span></p>

<p>[]()  </p>

<p><span>整体运行事件变长了，但是被分割成了很多块，<span>UI</span><span>不会卡死。其中最大的一块耗时其实是</span><span>Time Fire</span><span>：</span></span></p>

<p>[]()  </p>

<p><span>4<span>、需要注意的坑：</span></span></p>

<p><span>在<span>IE8</span><span>（其它浏览器未测试）下测试得出</span><span>setTimeout</span><span>过多后会莫名奇妙丢失最后一些：</span></span></p>

<p>[]()  </p>

<p><span></span></p>

<p><span>setTimeout<span>使用的间隔越小，丢失得越多。</span></span></p>

<p><span>另外不要迷恋<span>setTimeout</span><span>的时间，不会绝对精确，虽然在同一个</span><span>for</span><span>循环中使用相同间隔的计时器分割循环，最后执行的顺序会按照原来的顺序执行，但是通过下面这个例子可以知道</span><span>setTimeout</span><span>自身的定义就决定了它不适合用来通过时间做顺序控制。</span></span></p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">console.log(0);
    setTimeout(function(){
        console.log(1111111111111);
    }, 10);
    for(var i=0; i&lt;10000;i++){
        setTimeout(function(){
            console.log(1);
        }, 0);
    }
</code></pre></div>
<p><span>得出的结果是：</span></p>

<p>[]()  </p>

<p><span>5、</span><span>使用<span>setTimeout</span><span>做性能优化的一些原则：</span></span></p>

<p><span>1<span>：适用与处理过程不必须同步，不必须按顺序处理的任务。</span></span></p>

<p><span>2<span>：普遍来说，最好使用至少</span><span>25</span><span>毫秒的延迟，延迟过小对</span><span>UI</span><span>更新来说会不够。</span></span></p>

<p><span>3<span>：不要过多的使用</span><span>setTimeout</span><span>，使得片段过小，定时器数量过多。</span></span></p>

<p><span><span><br>
</span></span></p>

<p><span><span>6、</span><span>Web Workers</span></span></p>

<p>......</p>

  </div>
  <div class="post-meta">
    <span>Tags: </span>
    
      <span style="margin: 5px"><a href="/tags.html#js">js</a></span>
    
  </div>
  <div class="section-nav">
    <div class="left align-left">
      
      <a href="/2012/07/11/%E6%AD%A3%E5%BC%8F%E5%85%A5%E8%81%8C%E4%BA%86%EF%BC%8Cmark%E4%B8%80%E4%B8%8B.html" class="prev-next">上一篇:<b> 正式入职了，mark一下</b></a>
      
    </div>
    <div class="right align-right">
      
      <a href="/2012/08/11/%E9%80%9A%E8%BF%87URL%E8%AF%B7%E6%B1%82%E5%9B%BE%E7%89%87%E5%B9%B6%E5%AD%98%E5%82%A8%E5%88%B0%E6%B5%8F%E8%A7%88%E5%99%A8%E7%9A%84HTML5_FileSystem.html" class="prev-next">下一篇:<b> 通过URL请求图片并存储到浏览器的HTML5 FileSystem</b></a>
      
    </div>
  </div>
</article>
<div class="box">
<!-- baidu shared -->
<div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdPic":"","bdStyle":"0","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script>
<!-- Comment BEGIN -->
<!-- Duoshuo Comment BEGIN -->
<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"yutingzhao"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = 'http://static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- Duoshuo Comment END -->
<!-- Comment END -->
</div>


  </main>

  <footer>
    <a href='https://github.com/yutingzhao1991'>YuTingzhao</a> Copyright © 2014 i.yutingzhao.com
  </footer>
</body>
</html>
